(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){module.exports=function(){const SECONDS_IN_HOUR=3600,BORDER=5,MILE_PER_KM=.6213712,KM_PER_MILE=1.609344,KM_PER_METER=.001,MILE_PER_FT=18939e-8,FT_PER_METER=3.2808399,METER_PER_FT=.3048;return{distance:function(a,b){var dLng=b.lng-a.lng;var dLat=b.lat-a.lat;return Math.sqrt(dLng*dLng+dLat*dLat)},geometricDegreesToGeographic:function(degrees){if(degrees<0){degrees+=360}return(450-degrees)%360},heading:function(a,b){var radians=Math.atan2(b.lat-a.lat,b.lng-a.lng);var degrees=radians*180/Math.PI;degrees=this.geometricDegreesToGeographic(degrees);return degrees},midpoint:function(a,b){var lat=(a.lat+b.lat)/2;var lng=(a.lng+b.lng)/2;return L.latLng(lat,lng)},pad:function(num,size){var s=Math.floor(num).toFixed(0);while(s.length<size){s="0"+s}return s},time:function(speed,distance){var kmPerSecond=speed/SECONDS_IN_HOUR;return distance/kmPerSecond},maxBounds:function(mapConfig){return[[mapConfig.latMin-BORDER,mapConfig.lngMin-BORDER],[mapConfig.latMax+BORDER,mapConfig.lngMax+BORDER]]},tileBounds:function(mapConfig){return[[mapConfig.latMin+.01,mapConfig.lngMin+.01],[mapConfig.latMax,mapConfig.lngMax]]},center:function(mapConfig){return[mapConfig.latMax/2,mapConfig.lngMax/2]},gridLatLng:function(grid,mapConfig){var width=mapConfig.lngMax-mapConfig.lngMin;var height=mapConfig.latMax-mapConfig.latMin;var gridWidth=width/mapConfig.lngGridMax;var gridHeight=height/mapConfig.latGridMax;var gridSideLength=(gridWidth+gridHeight)/2;var gridLat=parseInt(grid.substring(0,2));var gridLng=parseInt(grid.substring(2,4));var lat=mapConfig.latMax-gridLat*gridSideLength;var lng=gridLng*gridSideLength;return[lat,lng]},invertHeading:function(heading){return(360+(heading-180))%360},convertSpeed:function(value,units){var factor=units==="metric"?KM_PER_MILE:MILE_PER_KM;return Math.round(value*factor)},convertDistance:function(value,units){var factor=units==="metric"?KM_PER_MILE:MILE_PER_KM;return(value*factor).toFixed(4)},convertAltitude:function(value,units){var factor=units==="metric"?METER_PER_FT:FT_PER_METER;return(value*factor).toFixed(2)},altitudeUnitAdjust:function(value,units){var factor=units==="metric"?KM_PER_METER:MILE_PER_FT;return(value*factor).toFixed(4)}}}()},{}],2:[function(require,module,exports){module.exports=function(){var conf=JSON.parse('{\n  "apiUrl"    : "NONE",\n  "serverUrl" : "https://serverror.github.io/IL2-Mission-Planner",\n  "tilesUrl"  : "https://serverror.github.io/IL2-Mission-Planner/tiles",\n  "streaming" : false,\n  "webdisUrl" : "https://serverror.github.io/IL2-Mission-Planner/WEBDIS"\n}\n');var augmentedLeafletDrawLocal={draw:{toolbar:{actions:{title:"Cancel",text:"Cancel"},finish:{title:"Finish",text:"Finish"},undo:{title:"Delete last point",text:"Delete last point"},buttons:{polyline:"Map a flight / Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Mark a point"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle"},radius:"Radius"},marker:{tooltip:{start:"Click to mark a point"}},polygon:{tooltip:{start:"Click to start drawing shape",cont:"Click to continue drawing shape",end:"Click first point to close this shape"}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start a flight plan / polyline",cont:"Click to continue the flight plan / polyline",end:"Click last point to finish flight plan / polyline"}},rectangle:{tooltip:{start:"Click and drag to draw rectangle"}},simpleshape:{tooltip:{end:"Release mouse to finish drawing"}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discard all changes",text:"Cancel"}},buttons:{edit:"Edit map",editDisabled:"Nothing to edit",remove:"Delete items from the map",removeDisabled:"Nothing to delete"}},handlers:{edit:{tooltip:{text:"Drag items to edit the map",subtext:null}},remove:{tooltip:{text:"Click to delete items from the map"}}}}};var mapConfigs={stalingrad:{fullName:"Stalingrad",name:"stalingrad",hash:"#stalingrad",selectIndex:0,scale:1.40056,latMin:0,latMax:164,latGridMax:23,lngMin:0,lngMax:252,lngGridMax:37,gridHopZoom:5,defaultZoom:3,minZoom:2,maxZoom:6,tileUrl:conf.tilesUrl+"/stalingrad/{z}/{x}/{y}.png"},moscow:{fullName:"Moscow",name:"moscow",hash:"#moscow",selectIndex:1,scale:1.46621,latMin:0,latMax:192,latGridMax:29,lngMin:0,lngMax:192,lngGridMax:29,gridHopZoom:5,defaultZoom:3,minZoom:2,maxZoom:6,tileUrl:conf.tilesUrl+"/moscow/{z}/{x}/{y}.png"},luki:{fullName:"Velikie Luki",name:"luki",hash:"#luki",selectIndex:2,scale:.65306,latMin:0,latMax:160,latGridMax:10.4,lngMin:0,lngMax:254,lngGridMax:17.6,gridHopZoom:4,defaultZoom:3,minZoom:2,maxZoom:6,tileUrl:conf.tilesUrl+"/luki/{z}/{x}/{y}.png"},kuban:{fullName:"Kuban",name:"kuban",hash:"#kuban",selectIndex:3,scale:2.876397232,latMin:0,latMax:103,latGridMax:29.7,lngMin:0,lngMax:148,lngGridMax:42.5,gridHopZoom:6,defaultZoom:4,minZoom:2,maxZoom:7,tileUrl:conf.tilesUrl+"/kuban/{z}/{x}/{y}.png"},rheinland:{fullName:"Rheinland",name:"rheinland",hash:"#rheinland",selectIndex:4,scale:2.876397232,latMin:0,latMax:113,latGridMax:32.4437,lngMin:0,lngMax:140,lngGridMax:40.1306,gridHopZoom:6,defaultZoom:4,minZoom:2,maxZoom:7,tileUrl:conf.tilesUrl+"/rheinland/{z}/{x}/{y}.png"},arras:{fullName:"Arras",name:"arras",hash:"#arras",selectIndex:5,scale:.7191,latMin:0,latMax:165,latGridMax:11.7973,lngMin:0,lngMax:165,lngGridMax:11.7973,gridHopZoom:5,defaultZoom:3,minZoom:3,maxZoom:5,tileUrl:conf.tilesUrl+"/arras/{z}/{x}/{y}.png"},prokhorovka:{fullName:"Prokhorovka",name:"prokhorovka",hash:"#prokhorovka",selectIndex:6,scale:.6491,latMin:0,latMax:165,latGridMax:10.6484,lngMin:0,lngMax:165,lngGridMax:10.6484,gridHopZoom:5,defaultZoom:4,minZoom:3,maxZoom:6,tileUrl:conf.tilesUrl+"/prokhorovka/{z}/{x}/{y}.png"}};var defaults={flightName:"New Flight",flightSpeed:300,flightAltitude:1e3,flightColor:"red",pointType:"point",pointColor:"red",pointName:"New Marker",circleColor:"red",polygonColor:"red"};var validatinatorConfig={"grid-jump-form":{"grid-input":"digitsLength:4"},"flight-leg-form":{"flight-leg-speed":"between:0,9999"},"connect-form":{"stream-password":"required","stream-code":"requiredIf:leader-checkbox:checked"}};return{augmentedLeafletDrawLocal:augmentedLeafletDrawLocal,maps:mapConfigs,default:defaults,validatinatorConfig:validatinatorConfig,titleText:'Il-2 Mission Planner <a href="https://github.com/ServError/il2missionplanner.com">Revived</a>',helpTooltip:"How to use this tool",clearTooltip:"Clear the map",exportTooltip:"Export mission plan",importTooltip:"Import mission plan",gridHopTooltip:"Jump to grid",missionHopTooltip:"Jump to mission",settingsTooltip:"Settings",streamTooltip:conf.streaming===true?"Stream mission plan":"Streaming disabled on this server",flightModalTemplate:'<div id="flight-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-plane modal-icon\'></span> Configure Flight / Line</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <label for="flight-color">Color</label>\n            <select class="eleven columns" id="flight-color">\n                <option value="red">Red</option>\n                <option value="black">Black</option>\n                <option value="blue">Blue</option>\n            </select>\n        </div>\n        <div class="row">\n            <div class="five columns">\n                <label class="checkbox-label" for="flight-plan-checkbox">Flight Plan?</label>\n                <input id="flight-plan-checkbox" name="flight-plan-checkbox" type="checkbox" checked>\n            </div>\n        </div>\n        <fieldset>\n            <legend>Flight Plan Settings</legend>\n            <div class="row">\n                <label for="flight-name">Flight name</label>\n                <input id="flight-name" class="half-width" value="{name}" placeholder="name"></input>\n            </div>\n            <div class="row">\n                <label for="flight-speed">Average speed (kph/mph)</label>\n                <input id="flight-speed" class="half-width" value="{speed}"></input>\n            </div>\n            <div class="row">\n                <label for="flight-altitude">Average Altitude (m/ft)</label>\n                <input id="flight-altitude" class="half-width" value="{altitude}"></input>\n            </div>\n        </fieldset>\n        <div class="row buttom-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel" type="button">Cancel</button>\n        </div>\n    </form>\n</div>\n',flightTurnModalTemplate:'<div id="flight-turn-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-plane modal-icon\'></span> Flight Turn Point</h2>\n    </div>\n    <div id="flight-turn-error" class="row error-message hidden-section">\n    </div>\n    <form name="flight-turn-form" id="flight-turn-form" onsubmit="return false;">\n        <div class="row">\n            <label class="" for="flight-altitude">Altitude (m/ft)</label>\n            <input id="flight-turn-altitude" name="flight-turn-altitude" class="half-width" value="{altitude}"></input>\n        </div>\n        <div class="row buttom-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel" type="button">Cancel</button>\n        </div>\n    </form>\n</div>\n',flightLegModalTemplate:'<div id="flight-leg-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-plane modal-icon\'></span> Flight Leg</h2>\n    </div>\n    <div id="flight-leg-error" class="row error-message hidden-section">\n    </div>\n    <form name="flight-leg-form" id="flight-leg-form" onsubmit="return false;">\n        <div class="row">\n            <label class="" for="flight-speed">Speed (kph/mph)</label>\n            <input id="flight-leg-speed" name="flight-leg-speed" class="half-width" value="{speed}"></input>\n        </div>\n        <div class="row buttom-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel" type="button">Cancel</button>\n        </div>\n    </form>\n</div>\n',circleModalTemplate:'<div id="circle-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-circle modal-icon\'></span>Circle color</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <label for="circleColor">Color</label>\n            <select class="eleven columns" id="circleColor">\n                <option value="red">Red</option>\n                <option value="black">Black</option>\n                <option value="blue">Blue</option>\n            </select>\n        </div>\n        <div class="row">\n            <div class="five columns">\n                <label class="checkbox-label" for="circle-fill-checkbox">\n                    Fill circle?\n                </label>\n            </div>\n            <div class="seven columns">\n                <input id="circle-fill-checkbox" name="circle-fill-checkbox" type="checkbox">\n            </div>\n        </div>\n        <div class="row buttom-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel" type="button">Cancel</button>\n        </div>\n    </form>\n</div>\n',polygonModalTemplate:'<div id="polygon-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-star-o modal-icon\'></span>Polygon color</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <label for="polygonColor">Color</label>\n            <select class="eleven columns" id="polygonColor">\n                <option value="red">Red</option>\n                <option value="black">Black</option>\n                <option value="blue">Blue</option>\n            </select>\n        </div>\n        <div class="row">\n            <div class="five columns">\n                <label class="checkbox-label" for="polygon-fill-checkbox">Fill polygon?</label>\n                <input id="polygon-fill-checkbox" name="polygon-fill-checkbox" type="checkbox">\n            </div>\n        </div>\n        <div class="row buttom-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel" type="button">Cancel</button>\n        </div>\n    </form>\n</div>\n',confirmClearModalTemplate:'<div id="confirm-clear-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-trash modal-icon\'></span> Clear the map</h2>\n    </div>\n    <div class="row">\n        <p>\n            Are you sure? This action cannot be undone.\n        </p>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row buttom-row">\n            <button id="confirm-cancel-button" class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n',helpModalTemplate:'<div id="help-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-question modal-icon\'></span> Help</h2>\n    </div>\n    <div class="row">\n        <h3 class="help-header" style="text-align:center">Map your flight plan</h3>\n    </div>\n    <div class="row">\n        <p>\n            Use the <span class="bold">flight mapping tool</span> <span class=\'fa fa-plane\'></span>\n            to plan your flight, one leg at a time. After naming your flight and giving it a default speed,\n            you can edit the speed of a particular leg by clicking on it\'s info.\n        </p>\n    </div>\n    <div class="row">\n        <p>\n            Use the <span class="bold">point mapping tool</span> <span class=\'fa fa-map-marker\'></span>\n            to mark a point of interest, such as a target, airfield or ground position. Hover over points\n            to view their notes.\n        </p>\n    </div>\n    <div class="row">\n        <p>\n            After placement, use the <span class="bold">edit button</span> <span class=\'fa fa-edit\'></span>\n            to move and change elements on the map. Use the <span class="bold">delete button</span>\n            <span class=\'fa fa-eraser\'></span> to remove specific elements, and clear the entire map\n            with the <span class="bold">clear button</span> <span class=\'fa fa-trash\'></span>.\n        </p>\n    </div>\n    <div class="row">\n        <h3 class="help-header" style="text-align:center">Navigate the map</h3>\n    </div>\n    <div class="row">\n        <p>\n            Use the <span class="bold">jump to grid tool</span> <span class=\'fa fa-th-large\'></span>\n            to jump to a specific, four digit grid number on the map.\n        </p>\n    </div>\n    <div class="row">\n        <p>\n            Use the <span class="bold">crop tool</span> <span class=\'fa fa-crop\'></span>\n            to fit the current flight plan in the window.\n        </p>\n    </div>\n    <div class="row">\n        <h3 class="help-header" style="text-align:center">Share mission plans</h3>\n    </div>\n    <div class="row">\n        <p>\n            Use the <span class="bold">export tool</span> <span class=\'fa fa-download\'></span>\n            to download a save file of the current mission plan.\n        </p>\n    </div>\n    <div class="row">\n        <p>\n            Use the <span class="bold">import tool</span> <span class=\'fa fa-upload\'></span>\n            to load a mission plan from a save file.\n        </p>\n    </div>\n    <div class="row">\n        <p>\n            Use the <span class="bold">stream tool</span> <span class=\'fa fa-share-alt\'></span>\n            to share missions in real time. Leaders can share their plans with viewers in a\n            password protected session.\n        </p>\n    </div>\n    <div class="row">\n        <h3 class="help-header" style="text-align:center">Configure the map</h3>\n    </div>\n    <div class="row">\n        <p>\n            Access the <span class="bold">settings</span> <span class=\'fa fa-gear\'></span>\n            to change the map and alter the style of the map text.\n        </p>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row buttom-row">\n            <button id="help-done-button" class="modal-ok button-primary" type="submit">Done</button>\n        </div>\n    </form>\n</div>\n',pointModalTemplate:'<div id="target-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-map-marker modal-icon\'></span> Point of Interest</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <label class="" for="target-name">Name</label>\n            <input id="target-name" class="half-width" value="{name}" placeholder="name"></input>\n        </div>\n        <div class="row">\n            <label for="point-type-select">Type</label>\n            <select class="u-full-width" id="point-type-select">\n                <option value="point">Point</option>\n                <option value="marker">Marker</option>\n                <option value="target">Target</option>\n                <option value="bomb-target">Bombing Target</option>\n                <option value="combat">Combat</option>\n                <option value="ground-combat">Ground Combat</option>\n                <option value="takeoff">Takeoff</option>\n                <option value="landing">Landing</option>\n                <option value="base">Base</option>\n                <option value="plane">Aircraft</option>\n                <option value="re-af">Airfield (Random Expert)</option>\n                <option value="re-art">Artillery (Random Expert)</option>\n                <option value="re-hq">Headquarters (Random Expert)</option>\n                <option value="re-motorcade">Motorcade (Random Expert)</option>\n                <option value="re-point-active">Active Point (Random Expert)</option>\n                <option value="re-point">Point (Random Expert)</option>\n                <option value="re-tanks">Tank (Random Expert)</option>\n                <option value="re-warehouse">Warehouse (Random Expert)</option>\n                <option value="re-fort">Fort (Random Expert)</option>\n                <option value="taw-af">Airfield (TAW)</option>\n                <option value="taw-arta">Artillery (TAW)</option>\n                <option value="taw-bridge">Bridge (TAW)</option>\n                <option value="taw-city">City (TAW)</option>\n                <option value="taw-def">Defences (TAW)</option>\n                <option value="taw-depo">Depot (TAW)</option>\n                <option value="taw-supply">Supply (TAW)</option>\n                <option value="taw-tank">Tank (TAW)</option>\n                <option value="taw-train">Train (TAW)</option>\n            </select>\n        </div>\n        <div class="row">\n            <label for="point-color-select">Color</label>\n            <select class="u-full-width" id="point-color-select">\n                <option value="black">Black</option>\n                <option value="red">Red</option>\n                <option value="blue">Blue</option>\n            </select>\n        </div>\n        <div class="row">\n            <p>Note: If a black icon is unavailable, it will default to blue.</p>\n        </div>\n        <div class="row">\n            <label class="" for="target-notes">Notes</label>\n            <textarea id="target-notes" class="u-full-width" value="{notes}">{notes}</textarea>\n        </div>\n        <div class="row button-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel" type="button">Cancel</button>\n        </div>\n    </form>\n</div>\n',importModalTemplate:'<div id="import-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-upload modal-icon\'></span> Import Mission</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <input id="import-file" type="file" name="importFile"></input>\n        </div>\n        <div class="row buttom-row">\n            <button class="modal-ok button-primary" type="submit">Import</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n',gridJumpModalTemplate:'<div id="gridhop-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-th-large modal-icon\'></span> Jump to Grid</h2>\n    </div>\n    <div id="grid-jump-error" class="row error-message hidden-section">\n    </div>\n    <form name="grid-jump-form" id="grid-jump-form" onsubmit="return false;">\n        <div class="modal-item row">\n            <label class="modal-item-label" for="grid-input">Grid</label>\n            <input id="grid-input" name="grid-input" class="modal-item-input" placeholder="0000" maxlength="4"></input>\n        </div>\n        <div class="row buttom-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel" type="button">Cancel</button>\n        </div>\n    </form>\n</div>\n',settingsModalTemplate:'<div id="settings-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-gear modal-icon\'></span> Settings</h2>\n    </div>\n    <form id="settings-form" onsubmit="return false;">\n        <fieldset>\n            <legend>Select Map</legend>\n            <div class="row">\n                <div class="one column"></div>\n                <select class="eleven columns" id="map-select">\n                    <option value="stalingrad">Stalingrad</option>\n                    <option value="moscow">Moscow</option>\n                    <option value="luki">Velikie Luki</option>\n                    <option value="kuban">Kuban</option>\n                    <option value="rheinland">Rheinland</option>\n                    <option value="arras">Arras</option>\n                    <option value="prokhorovka">Prokhorovka</option>\n                </select>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>Units of Measurement</legend>\n            <div class="row">\n                <div class="one column"></div>\n                <select class="eleven columns" id="units-select">\n                    <option value="metric">Metric</option>\n                    <option value="imperial">Imperial</option>\n                </select>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>Map Text</legend>\n            <div class="row">\n                <div class="one column"></div>\n                <div class="three columns">\n                    <label class="" for="selectStyle">Style (Changes will trigger a reload, save first)</label>\n                </div>\n                <select class="eleven columns" id="style-select">\n                    <option value="cb">CB</option>\n                    <option value="classic">Classic</option>\n                </select>\n            </div>\n            <fieldset>\n                <legend>Classic Style Settings</legend>\n                <div class="row">\n                    <div class="one column"></div>\n                    <div class="three columns">\n                        <label class="" for="invertText">Dark</label>\n                    </div>\n                    <div class="eight columns">\n                        <input id="invert-text-checkbox" type="checkbox" name="invertText">\n                    </div>\n                </div>\n                <div class="row">\n                    <div class="one column"></div>\n                    <div class="three columns">\n                        <label class="" for="showBackground">Background</label>\n                    </div>\n                    <div class="eight columns">\n                        <input id="text-background-checkbox" type="checkbox" name="showBackground" value="inverted">\n                    </div>\n                </div>\n            </fieldset>\n        </fieldset>\n        <div class="row button-row">\n            <button class="modal-ok button-primary" type="submit">Okay</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n',streamModalTemplate:'<div id="stream-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-share-alt modal-icon\'></span> Mission Streaming</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <p>\n                Start streaming or connect to an existing one.\n            </p>\n        </div>\n        <div class="row buttom-row">\n            <button id="stream-start-button" class="modal-ok button-primary" type="submit">New Stream</button>\n            <button id="stream-connect-button" class="modal-ok button-primary" type="submit">Connect</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n',startStreamModalTemplate:'<div id="stream-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-share-alt modal-icon\'></span> Start Streaming</h2>\n    </div>\n    <div id="start-stream-error" class="row error-message hidden-section">\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <div class="row">\n                <label for="stream-name">Stream name</label>\n                <input id="stream-name" class="half-width" placeholder="name" maxlength="32"></input>\n            </div>\n            <div class="row">\n                <label for="stream-password">Password</label>\n                <input id="stream-password" class="half-width" placeholder="password" maxlength="32"></input>\n            </div>\n            <div class="row">\n                <label for="stream-leader-code">Leader code</label>\n                <input id="stream-leader-code" class="half-width" placeholder="code" maxlength="32"></input>\n            </div>\n        </div>\n        <div class="row buttom-row">\n            <button id="stream-start-confirm-button" class="modal-ok button-primary" type="submit">Start Streaming</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n',connectStreamModalTemplate:'<div id="connect-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-share-alt modal-icon\'></span> Start Streaming</h2>\n    </div>\n    <div id="connect-stream-error" class="row error-message hidden-section">\n    </div>\n    <form name="connect-form" onsubmit="return false;">\n        <fieldset>\n            <legend>Select Stream</legend>\n            <div class="row">\n                <div class="one column"></div>\n                <select id="stream-select" class="eleven columns" id="stream-select">\n                </select>\n            </div>\n        </fieldset>\n        <div class="row">\n            <label for="stream-password">Password</label>\n            <input id="stream-password" name="stream-password" class="half-width" placeholder="password"></input>\n        </div>\n        <div class="row">\n            <div class="five columns">\n                <label class="checkbox-label" for="leader-checkbox">\n                    Connect as flight leader?\n                </label>\n            </div>\n            <div class="seven columns">\n                <input id="leader-checkbox" name="leader-checkbox" type="checkbox">\n            </div>\n        </div>\n        <div id="leader-hidden" class="row hidden-section">\n            <label for="stream-code">Leader Code</label>\n            <input id="stream-code" name="stream-code" class="half-width" placeholder="code"></input>\n        </div>\n        <div class="row buttom-row">\n            <button id="stream-connect-button" class="modal-ok button-primary" type="submit">Connect</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n',alreadyConnectedModalTemplate:'<div id="already-connected-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-share-alt modal-icon\'></span> Connected</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <p>\n                You are currently connected.\n            </p>\n        </div>\n        <div class="row">\n            <p>\n                <b>Stream Name: </b>{streamName}\n            </p>\n        </div>\n        <div class="row buttom-row">\n            <button id="disconnect-button" class="modal-ok button-primary" type="submit">Disconnect</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n',alreadyStreamingModalTemplate:'<div id="already-streaming-modal" class="container">\n    <div class="row">\n        <h2><span class=\'fa fa-share-alt modal-icon\'></span> Streaming</h2>\n    </div>\n    <form onsubmit="return false;">\n        <div class="row">\n            <p>\n                You are currently streaming your mission plan.\n            </p>\n        </div>\n        <div class="row">\n            <p>\n                <b>Stream Name: </b>{streamName}\n            </p>\n        </div>\n        <div class="row">\n            <div class="six columns">\n                <label class="checkbox-label" for="already-streaming-checkbox">\n                    Show password and leader code?\n                </label>\n            </div>\n            <div class="six columns">\n                <input id="already-streaming-checkbox" name="already-streaming-checkbox" type="checkbox">\n            </div>\n        </div>\n        <div id="already-streaming-hidden" class="row hidden-section">\n            <p>\n                <b>Password: </b>{streamPassword}<br>\n                <b>Leader Code: </b>{streamCode}\n            </p>\n        </div>\n        <div class="row buttom-row">\n            <button id="stop-streaming-button" class="modal-ok button-primary" type="submit">Stop Streaming</button>\n            <button class="modal-cancel">Cancel</button>\n        </div>\n    </form>\n</div>\n'}}()},{}],3:[function(require,module,exports){(function(){var content=require("./content.js");L.Control.TitleControl=L.Control.extend({options:{position:"topright"},onAdd:function(e){L.DomEvent.stop(e);var container=L.DomUtil.create("div","title-control");L.DomEvent.disableClickPropagation(container);container.innerHTML=content.titleText;return container}});L.Control.CustomToolbar=L.Control.extend({options:{position:"bottomleft"},initialize:function(options){L.Control.prototype.initialize.call(this,options)},onAdd:function(e){L.DomEvent.stop(e);var container=L.DomUtil.create("div","leaflet-bar");L.DomEvent.disableClickPropagation(container);for(var i=0;i<this.options.buttons.length;i++){var link=L.DomUtil.create("a","fa "+this.options.buttons[i].icon,container);link.title=this.options.buttons[i].tooltip;link.id=this.options.buttons[i].id;link.addEventListener("click",this.options.buttons[i].clickFn)}return container}})})()},{"./content.js":2}],4:[function(require,module,exports){module.exports=function(leaflet){const URL_PREFIX="img/",URL_SUFFIX=".png",URL_DELIM="-";function buildIconUrl(type,color){return URL_PREFIX+color+URL_DELIM+type+URL_SUFFIX}return{factory:function(type,color){if(color==="black"&&(this._isRandomExpertIcon(type)||this._isTawIcon(type))){color="blue"}var iconOpts={iconSize:type==="re-point-active"?[40,60]:[32,32],iconUrl:buildIconUrl(type,color)};return leaflet.icon(iconOpts)},textIconFactory:function(text,classes){return leaflet.divIcon({className:classes,html:text,iconSize:[165,0]})},_isRandomExpertIcon:function(type){return type.substring(0,2)==="re"},_isTawIcon:function(type){return type.substring(0,3)==="taw"&&type!=="taw-af"}}}},{}],5:[function(require,module,exports){(function(){"use strict";var content=require("./content.js");var calc=require("./calc.js");var util=require("./util.js");var icons=require("./icons.js")(L);var webdis=require("./webdis.js");require("./controls.js");var conf=JSON.parse('{\n  "apiUrl"    : "NONE",\n  "serverUrl" : "https://serverror.github.io/IL2-Mission-Planner",\n  "tilesUrl"  : "https://serverror.github.io/IL2-Mission-Planner/tiles",\n  "streaming" : false,\n  "webdisUrl" : "https://serverror.github.io/IL2-Mission-Planner/WEBDIS"\n}\n');const RED="#9A070B",RED_FRONT="#BD0101",BLUE="#3C6490",BLUE_FRONT="#4D4B40",BLACK="#000000",FLIGHT_OPACITY=.8,CIRCLE_OPTIONS={color:RED,weight:2,opacity:FLIGHT_OPACITY},LINE_OPTIONS={color:RED,weight:2,opacity:FLIGHT_OPACITY,fillOpacity:-1};var map,mapTiles,mapConfig,drawnItems,drawnMarkers,hiddenLayers,frontline,drawControl,selectedMapIndex;var state={units:window.localStorage.getItem("units")||"metric",style:window.localStorage.getItem("style")||"cb",colorsInverted:false,showBackground:true,streaming:false,connected:false,changing:false,streamInfo:{},streamingAvailable:conf.streaming===true?webdis.init():false};L.PolylineDecorator.include(L.Mixin.Events);L.drawLocal=content.augmentedLeafletDrawLocal;L.CRS.XY=L.Util.extend({},L.CRS.Simple,{code:"XY",projection:L.Projection.LonLat,transformation:new L.Transformation(1,0,-1,0),infinite:true});var V=new Validatinator(content.validatinatorConfig);function mapIsEmpty(){return drawnItems.getLayers().length===0&&frontline.getLayers().length===0}function applyCircle(circle){if(state.changing||state.connected){return}if(typeof circle.color==="undefined"){circle.options.color=content.default.circleColor}var clickedOk=false;map.openModal({color:circle.options.color,fillOpacity:circle.options.fillOpacity,template:content.circleModalTemplate,zIndex:1e4,onShow:function(e){var element=document.getElementById("circleColor");element.focus();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){clickedOk=true;e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})},onHide:function(e){if(clickedOk){circle.options.color=document.getElementById("circleColor").value;var circleFillCheckbox=document.getElementById("circle-fill-checkbox");switch(circle.options.color){case"blue":circle.options.color=BLUE;break;case"black":circle.options.color=BLACK;break;case"red":default:circle.options.color=RED;break}circle.setStyle({color:circle.options.color});if(!circleFillCheckbox.checked){circle.options.fillOpacity=0}else{circle.options.fillOpacity=.2}circle.setStyle({fillOpacity:circle.options.fillOpacity})}else{drawnItems.removeLayer(circle)}checkButtonsDisabled()}})}function applyPolygon(polygon){if(state.changing||state.connected){return}if(typeof polygon.color==="undefined"){polygon.options.color=content.default.polygonColor}var clickedOk=false;map.openModal({color:polygon.options.color,fillOpacity:polygon.options.fillOpacity,template:content.polygonModalTemplate,zIndex:1e4,onShow:function(e){var element=document.getElementById("polygonColor");element.focus();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){clickedOk=true;e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})},onHide:function(e){if(clickedOk){polygon.options.color=document.getElementById("polygonColor").value;var polygonFillCheckbox=document.getElementById("polygon-fill-checkbox");switch(polygon.options.color){case"blue":polygon.options.color=BLUE;break;case"black":polygon.options.color=BLACK;break;case"red":default:polygon.options.color=RED;break}polygon.setStyle({color:polygon.options.color});if(!polygonFillCheckbox.checked){polygon.options.fillOpacity=0}else{polygon.options.fillOpacity=.2}polygon.setStyle({fillOpacity:polygon.options.fillOpacity})}else{drawnItems.removeLayer(polygon)}checkButtonsDisabled()}})}function newFlightDecorator(route){return L.polylineDecorator(route,{patterns:[{offset:6,repeat:300,symbol:L.Symbol.arrowHead({pathOptions:{opacity:0,fillOpacity:FLIGHT_OPACITY,color:route.color}})}]})}function applyCustomFlightTurn(marker){if(state.changing||state.connected){return}var parentRoute=drawnItems.getLayer(marker.parentId);map.openModal({altitude:marker.options.altitude,template:content.flightTurnModalTemplate,zIndex:1e4,onShow:function(e){var element=document.getElementById("flight-turn-altitude");element.focus();element.select();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){if(V.passes("flight-turn-form")){var newAltitude=parseInt(element.value);parentRoute.altitudes[marker.index]=newAltitude;marker.options.altitude=newAltitude;if(marker.priorMarkerId!==0){var altDiff=calc.altitudeUnitAdjust(Math.abs(parentRoute.altitudes[marker.index]-parentRoute.altitudes[marker.index-1]),state.units);var priorMarker=drawnMarkers.getLayer(marker.priorMarkerId);priorMarker.options.altDiff=altDiff;applyCustomFlightLegCallback(priorMarker)}if(marker.followingMarkerId!==0){altDiff=calc.altitudeUnitAdjust(Math.abs(parentRoute.altitudes[marker.index]-parentRoute.altitudes[marker.index+1]),state.units);var followingMarker=drawnMarkers.getLayer(marker.followingMarkerId);followingMarker.options.altDiff=altDiff;applyCustomFlightLegCallback(followingMarker)}applyCustomFlightTurnCallback(marker);e.modal.hide()}else{var errorElement=document.getElementById("flight-turn-error");var units=state.units==="metric"?"meters":"feet";errorElement.innerHTML="Please input a valid altitude in"+units+".";util.removeClass(errorElement,"hidden-section");errorElement.focus()}});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}function applyCustomFlightTurnCallback(marker){var newContent=util.formatFlightTurnMarker(marker.options.altitude,state.units);if(marker.priorMarkerId!==0){marker.setIcon(icons.textIconFactory(newContent,"flight-turn "+getMapTextClasses(state)))}else{marker.setIcon(icons.textIconFactory(newContent,"flight-start-alt "+getMapTextClasses(state)))}publishMapState()}function applyCustomFlightLeg(marker){if(state.changing||state.connected){return}var parentRoute=drawnItems.getLayer(marker.parentId);map.openModal({speed:parentRoute.speeds[marker.index],template:content.flightLegModalTemplate,zIndex:1e4,onShow:function(e){var element=document.getElementById("flight-leg-speed");element.focus();element.select();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){if(V.passes("flight-leg-form")){var newSpeed=parseInt(element.value);parentRoute.speeds[marker.index]=newSpeed;marker.options.speed=newSpeed;applyCustomFlightLegCallback(marker);e.modal.hide()}else{var errorElement=document.getElementById("flight-leg-error");var units=state.units==="metric"?"kilometers":"miles";errorElement.innerHTML="Please input a valid speed in"+units+"per hour.";util.removeClass(errorElement,"hidden-section");errorElement.focus()}});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}function applyCustomFlightLegCallback(marker){marker.options.time=util.formatTime(calc.time(marker.options.speed,parseFloat(marker.options.gndDistance)+parseFloat(marker.options.altDiff)));var newContent=util.formatFlightLegMarker(marker.options.gndDistance,marker.options.heading,marker.options.speed,marker.options.time,state.units);marker.setIcon(icons.textIconFactory(newContent,"flight-leg "+getMapTextClasses(state)));publishMapState()}function applyFlightPlanCallback(route,newFlight){const routeClickHandlerFactory=function(clickedRoute){return function(){if(state.changing||state.connected){return}deleteAssociatedLayers(L.layerGroup([clickedRoute]));applyFlightPlan(clickedRoute)}};const markerClickHandlerFactory=function(clickedMarker){return function(){if(state.changing||state.connected){return}applyCustomFlightLeg(clickedMarker)}};const turnClickHandlerFactory=function(clickedMarker){return function(){if(state.changing||state.connected){return}applyCustomFlightTurn(clickedMarker)}};if(newFlight){route.on("click",routeClickHandlerFactory(route))}var id=route._leaflet_id;var coords=route.getLatLngs();var decorator=newFlightDecorator(route);decorator.parentId=id;decorator.addTo(drawnMarkers);if(typeof route.speeds==="undefined"||route.speedDirty||route.wasEdited){route.speeds=util.defaultPopulateArray(route.speed,coords.length-1);route.speedDirty=false}if(typeof route.altitudes==="undefined"||route.altitudeDirty||route.wasEdited){route.altitudes=util.defaultPopulateArray(route.altitude,coords.length);route.altitudeDirty=false}var turnCoords=L.latLng(coords[0].lat,coords[0].lng);var turnMarkerContent=util.formatFlightTurnMarker(route.altitudes[0],state.units);var turnMarker=L.marker(turnCoords,{altitude:route.altitudes[0],draggable:false,icon:icons.textIconFactory(turnMarkerContent," flight-start-alt "+getMapTextClasses(state))});turnMarker.parentId=id;turnMarker.priorMarkerId=0;turnMarker.index=0;turnMarker.on("click",turnClickHandlerFactory(turnMarker));turnMarker.addTo(drawnMarkers);turnMarker.followingMarkerId=turnMarker._leaflet_id+1;for(var i=0;i<coords.length-1;i++){var altDiff=calc.altitudeUnitAdjust(Math.abs(route.altitudes[i]-route.altitudes[i+1]),state.units);var gndDistance=mapConfig.scale*calc.distance(coords[i],coords[i+1]);var airDistance=parseFloat(altDiff)+parseFloat(gndDistance);var heading=calc.heading(coords[i],coords[i+1]);var midpoint=calc.midpoint(coords[i],coords[i+1]);var time=util.formatTime(calc.time(route.speeds[i],airDistance));var markerContent=util.formatFlightLegMarker(gndDistance,heading,route.speeds[i],time,state.units);var marker=L.marker(midpoint,{altDiff:altDiff,gndDistance:gndDistance,heading:heading,time:time,speed:route.speeds[i],icon:icons.textIconFactory(markerContent,"flight-leg "+getMapTextClasses(state))});marker.parentId=id;marker.index=i;marker.on("click",markerClickHandlerFactory(marker));marker.addTo(drawnMarkers);turnCoords=L.latLng(coords[i+1].lat,coords[i+1].lng);turnMarkerContent=util.formatFlightTurnMarker(route.altitudes[i+1],state.units);turnMarker=L.marker(turnCoords,{altitude:route.altitudes[i],draggable:false,icon:icons.textIconFactory(turnMarkerContent," flight-turn "+getMapTextClasses(state))});turnMarker.parentId=id;turnMarker.priorMarkerId=marker._leaflet_id;if(i!==coords.length-2){turnMarker.followingMarkerId=marker._leaflet_id+2}else{turnMarker.followingMarkerId=0}turnMarker.index=i+1;turnMarker.on("click",turnClickHandlerFactory(turnMarker));turnMarker.addTo(drawnMarkers)}for(var i=0;i<coords.length-1;i++){var routeMarker=L.circleMarker(coords[i],{clickable:true,radius:1,color:route.color,fillColor:route.color,opacity:FLIGHT_OPACITY,fillOpacity:FLIGHT_OPACITY});routeMarker.parentId=id;routeMarker.index=i;routeMarker.addTo(drawnMarkers)}var endMarker=L.circleMarker(coords[coords.length-1],{clickable:false,radius:3,color:route.color,fillColor:route.color,opacity:FLIGHT_OPACITY,fillOpacity:FLIGHT_OPACITY});endMarker.parentId=id;endMarker.addTo(drawnMarkers);var nameCoords=L.latLng(coords[0].lat,coords[0].lng);var nameMarker=L.marker(nameCoords,{draggable:false,icon:icons.textIconFactory(route.name,"map-title flight-titles "+getMapTextClasses(state))});nameMarker.parentId=id;nameMarker.on("click",routeClickHandlerFactory(route));nameMarker.addTo(drawnMarkers);publishMapState()}function applyFlightPlan(route){if(state.changing||state.connected){return}var newFlight=false;if(typeof route.altitude==="undefined"){route.altitude=content.default.flightAltitude;newFlight=true}if(typeof route.speed==="undefined"){route.speed=content.default.flightSpeed;newFlight=true}if(typeof route.name==="undefined"){route.name=content.default.flightName}if(typeof route.color==="undefined"){route.color=content.default.flightColor}var initialSpeed=route.speed;var initialAltitude=route.altitude;var clickedOk=false;map.openModal({altitude:route.altitude,speed:route.speed,name:route.name,color:route.color,isFlightPlan:route.isFlightPlan,template:content.flightModalTemplate,zIndex:1e4,onShow:function(e){var element=document.getElementById("flight-name");element.focus();element.select();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){clickedOk=true;e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})},onHide:function(e){if(clickedOk){var flightPlanCheckbox=document.getElementById("flight-plan-checkbox");route.isFlightPlan=flightPlanCheckbox.checked;route.name=document.getElementById("flight-name").value;route.speed=parseInt(document.getElementById("flight-speed").value);route.speedDirty=route.speed!==initialSpeed;route.color=document.getElementById("flight-color").value;route.altitude=document.getElementById("flight-altitude").value;route.altitudeDirty=route.altitude!==initialAltitude;switch(route.color){case"blue":route.color=BLUE;break;case"black":route.color=BLACK;break;case"red":default:route.color=RED;break}route.setStyle({color:route.color});if(route.isFlightPlan){applyFlightPlanCallback(route,newFlight)}else{route.clickable=false}}else if(newFlight){drawnItems.removeLayer(route)}else if(route.isFlightPlan){applyFlightPlanCallback(route,newFlight)}checkButtonsDisabled()}})}function applyTargetInfoCallback(target,newTarget){function targetClickHandlerFactory(clickedTarget){return function(){if(state.changing||state.connected){return}deleteAssociatedLayers(L.layerGroup([clickedTarget]));applyTargetInfo(clickedTarget)}}var id=target._leaflet_id;var coords=target.getLatLng();target.setIcon(icons.factory(target.type,target.color));if(newTarget){target.on("click",targetClickHandlerFactory(target))}var nameCoords=L.latLng(coords.lat,coords.lng);if(state.style==="classic"){var nameMarker=L.marker(nameCoords,{draggable:false,icon:icons.textIconFactory(target.name,"map-title target-title-classic "+getMapTextClasses(state))})}else{var markerColor=BLACK;if(target.color==="red"){markerColor=RED}else if(target.color==="blue"){markerColor=BLUE}if(target.type==="taw-af"||target.type==="re-af"){var nameMarker=L.marker(nameCoords,{draggable:false,icon:icons.textIconFactory("<font color="+markerColor+">"+target.name+"</font>","target-title-airfield")})}else if(target.type==="point"){var nameMarker=L.marker(nameCoords,{draggable:false,icon:icons.textIconFactory(target.name,"target-title-classic-centered map-text flight-leg")})}else{var nameMarker=L.marker(nameCoords,{draggable:false,icon:icons.textIconFactory("<font color="+markerColor+">"+target.name+"</font>","target-title-cb nobg")})}}nameMarker.parentId=id;nameMarker.on("click",targetClickHandlerFactory(target));nameMarker.addTo(drawnMarkers);if(target.notes!==""){target.bindLabel(target.notes,{direction:"left"}).addTo(drawnMarkers)}publishMapState()}function applyTargetInfo(target){if(state.changing||state.connected){return}var newTarget=false;if(typeof target.name==="undefined"){target.name=content.default.pointName;var newTarget=true}if(typeof target.notes==="undefined"){target.notes=""}if(typeof target.type==="undefined"){target.type=content.default.pointType}if(typeof target.color==="undefined"){target.color=content.default.pointColor}var clickedOk=false;map.openModal({name:target.name,notes:target.notes,template:content.pointModalTemplate,zIndex:1e4,onShow:function(e){var element=document.getElementById("target-name");element.focus();element.select();var typeSelect=document.getElementById("point-type-select");typeSelect.value=target.type;var colorSelect=document.getElementById("point-color-select");colorSelect.value=target.color;L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){clickedOk=true;e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})},onHide:function(e){if(clickedOk){target.name=document.getElementById("target-name").value;target.notes=document.getElementById("target-notes").value;target.type=document.getElementById("point-type-select").value;target.color=document.getElementById("point-color-select").value;applyTargetInfoCallback(target,newTarget)}else if(newTarget){drawnItems.removeLayer(target)}else{applyTargetInfoCallback(target,newTarget)}checkButtonsDisabled()}})}function deleteAssociatedLayers(parentLayers){var toDelete=[];parentLayers.eachLayer(function(layer){toDelete.push(layer._leaflet_id)});map.eachLayer(function(layer){if(toDelete.indexOf(layer.parentId)!==-1){map.removeLayer(layer)}});hiddenLayers.eachLayer(function(layer){if(toDelete.indexOf(layer.parentId)!==-1){hiddenLayers.removeLayer(layer)}})}function transferChildLayers(from,to){from.eachLayer(function(layer){if(typeof layer.parentId!=="undefined"){from.removeLayer(layer);to.addLayer(layer)}})}function showChildLayers(){transferChildLayers(hiddenLayers,map)}function hideChildLayers(){transferChildLayers(map,hiddenLayers)}function changeUnits(units){state.units=units;window.localStorage.setItem("units",units);var parentChanged=false;map.eachLayer(function(layer){if(layer.options&&layer.options.speed){if(!parentChanged){var parentRoute=drawnItems.getLayer(layer.parentId);parentRoute.speeds=parentRoute.speeds.map(speed=>calc.convertSpeed(speed,units));parentRoute.altitudes=parentRoute.altitudes.map(altitude=>calc.convertAltitude(altitude,units));parentChanged=true}layer.options.altDiff=calc.convertDistance(layer.options.altDiff,units);layer.options.speed=calc.convertSpeed(layer.options.speed,units);layer.options.gndDistance=calc.convertDistance(layer.options.gndDistance,units);applyCustomFlightLegCallback(layer)}});map.eachLayer(function(layer){if(layer.options&&layer.options.altitude){if(!parentChanged){var parentRoute=drawnItems.getLayer(layer.parentId);parentRoute.speeds=parentRoute.speeds.map(speed=>calc.convertSpeed(speed,units));parentRoute.altitudes=parentRoute.altitudes.map(altitude=>calc.convertAltitude(altitude,units));parentChanged=true}layer.options.altitude=calc.convertAltitude(layer.options.altitude,units);applyCustomFlightTurnCallback(layer)}})}function changeStyle(style){state.style=style;window.localStorage.setItem("style",style);window.location.reload()}function disableButtons(buttonList){for(var i=0;i<buttonList.length;i++){var element=document.getElementById(buttonList[i]);element.classList.add("leaflet-disabled")}}function enableButtons(buttonList){for(var i=0;i<buttonList.length;i++){var element=document.getElementById(buttonList[i]);element.classList.remove("leaflet-disabled")}}function checkButtonsDisabled(){var buttons=["export-button","missionhop-button"];if(!state.connected){buttons.push("clear-button")}if(mapIsEmpty()){disableButtons(buttons)}else{enableButtons(buttons)}buttons=["stream-button"];if(conf.streaming!==true){disableButtons(buttons)}}function clearMap(){drawnItems.clearLayers();frontline.clearLayers();hideChildLayers();hiddenLayers.clearLayers();publishMapState()}function exportMapState(){var saveData={mapHash:window.location.hash,units:state.units,routes:[],points:[],circles:[],polygons:[]};drawnItems.eachLayer(function(layer){var saveLayer={};if(util.isPolygon(layer)){saveLayer.latLngs=layer.getLatLngs();saveLayer.color=layer.options.color;saveLayer.fillOpacity=layer.options.fillOpacity;saveData.polygons.push(saveLayer)}else if(util.isLine(layer)){saveLayer.latLngs=layer.getLatLngs();saveLayer.name=layer.name;saveLayer.speed=layer.speed;saveLayer.speeds=layer.speeds;saveLayer.altitude=layer.altitude;saveLayer.altitudes=layer.altitudes;saveLayer.color=layer.color;saveLayer.isFlightPlan=layer.isFlightPlan;saveData.routes.push(saveLayer)}else if(util.isCircle(layer)){saveLayer.latLng=layer.getLatLng();saveLayer.radius=layer.getRadius();saveLayer.color=layer.options.color;saveLayer.fillOpacity=layer.options.fillOpacity;saveData.circles.push(saveLayer)}else if(util.isMarker(layer)){saveLayer.latLng=layer.getLatLng();saveLayer.name=layer.name;saveLayer.type=layer.type;saveLayer.color=layer.color;saveLayer.notes=layer.notes;saveData.points.push(saveLayer)}});return saveData}function selectMap(selectedMapConfig){var newIndex=selectedMapConfig.selectIndex;if(newIndex!==selectedMapIndex){selectedMapIndex=selectedMapConfig.selectIndex;window.location.hash=selectedMapConfig.hash;deleteAssociatedLayers(drawnItems);drawnItems.clearLayers();hiddenLayers.clearLayers();map.removeLayer(mapTiles);mapTiles=L.tileLayer(selectedMapConfig.tileUrl,{minZoom:selectedMapConfig.minZoom,maxZoom:selectedMapConfig.maxZoom,noWrap:true,tms:true,continuousWorld:true,bounds:calc.tileBounds(selectedMapConfig)}).addTo(map);map.setMaxBounds(calc.maxBounds(selectedMapConfig));map.setView(calc.center(selectedMapConfig),selectedMapConfig.defaultZoom)}}function fitViewToMission(){map.fitBounds(drawnItems.getBounds())}function getMapTextClasses(state){var classes="map-text";if(state.colorsInverted&&state.style==="classic"){classes+=" inverted"}if(!state.showBackground&&state.style==="classic"){classes+=" nobg"}return classes}function importMapState(saveData){clearMap();var importedMapConfig=util.getSelectedMapConfig(saveData.mapHash,content.maps);selectMap(importedMapConfig);mapConfig=importedMapConfig;selectedMapIndex=mapConfig.selectIndex;state.units=saveData.units||"imperial";if(saveData.routes){for(var i=0;i<saveData.routes.length;i++){var route=saveData.routes[i];if(route.color!==BLUE&&route.color!==BLACK&&route.color!==RED){route.color=RED}var options={color:route.color,weight:2,opacity:FLIGHT_OPACITY,fillOpacity:-1};var newRoute=L.polyline(route.latLngs,options);newRoute.name=route.name;newRoute.speed=route.speed;newRoute.speeds=route.speeds;newRoute.altitude=route.altitude;newRoute.altitudes=route.altitudes;newRoute.color=route.color;newRoute.isFlightPlan=route.isFlightPlan;drawnItems.addLayer(newRoute);if(newRoute.isFlightPlan){applyFlightPlanCallback(newRoute)}}}if(saveData.points){for(var i=0;i<saveData.points.length;i++){var point=saveData.points[i];var newPoint=L.marker(point.latLng,{icon:icons.factory(point.type,point.color)});newPoint.name=point.name;newPoint.type=point.type;newPoint.color=point.color;newPoint.notes=point.notes;drawnItems.addLayer(newPoint);applyTargetInfoCallback(newPoint)}}if(saveData.circles){for(var i=0;i<saveData.circles.length;i++){var circle=saveData.circles[i];var newCircle=L.circle(circle.latLng,circle.radius);newCircle.options.color=circle.color;newCircle.options.fillOpacity=circle.fillOpacity;newCircle.options.opacity=FLIGHT_OPACITY;newCircle.options.weight=2;drawnItems.addLayer(newCircle)}}if(saveData.polygons){for(var i=0;i<saveData.polygons.length;i++){var polygon=saveData.polygons[i];var options={color:polygon.color,weight:2,opacity:FLIGHT_OPACITY,fillOpacity:polygon.fillOpacity};var newPolygon=L.polygon(polygon.latLngs,options);newPolygon.options.color=polygon.color;newPolygon.options.fillOpacity=polygon.fillOpacity;drawnItems.addLayer(newPolygon)}}if(saveData.frontline){for(var frontNdx=0;frontNdx<saveData.frontline.length;frontNdx++){var blueFront=saveData.frontline[frontNdx][0];var redFront=saveData.frontline[frontNdx][1];L.polyline(blueFront,{color:BLUE_FRONT,opacity:1}).addTo(frontline);L.polyline(redFront,{color:RED_FRONT,opacity:1}).addTo(frontline)}}}function publishMapState(){if(state.streaming){var saveData=exportMapState();webdis.publish(state.streamInfo.name,state.streamInfo.password,state.streamInfo.code,window.escape(JSON.stringify(saveData)))}}function startConnectedMode(){map.removeControl(drawControl);map.removeControl(clearButton)}function endConnectedMode(){map.removeControl(gridToolbar);map.removeControl(importExportToolbar);map.addControl(drawControl);map.addControl(gridToolbar);map.addControl(clearButton);map.addControl(importExportToolbar);checkButtonsDisabled()}function setupCheckboxTogglableElement(checkboxId,elementId){var checkbox=document.getElementById(checkboxId);var element=document.getElementById(elementId);L.DomEvent.on(checkbox,"click",function(){if(checkbox.checked){util.removeClass(element,"hidden-section")}else{util.addClass(element,"hidden-section")}})}if(conf.apiUrl!=="NONE"&&window.location.hash!==""&&!util.isAvailableMapHash(window.location.hash,content.maps)){var responseBody=null;var url=conf.apiUrl+"/servers/"+window.location.hash.substr(1);var xhr=util.buildGetXhr(url,function(){if(xhr.readyState===4){responseBody=JSON.parse(xhr.responseText);importMapState(responseBody.data);fitViewToMission();checkButtonsDisabled()}})}mapConfig=util.getSelectedMapConfig(window.location.hash,content.maps);selectedMapIndex=mapConfig.selectIndex;map=L.map("map",{crs:L.CRS.XY,attributionControl:false});mapTiles=L.tileLayer(mapConfig.tileUrl,{minZoom:mapConfig.minZoom,maxZoom:mapConfig.maxZoom,noWrap:true,tms:true,continuousWorld:true,bounds:calc.tileBounds(mapConfig)}).addTo(map);map.setView(calc.center(mapConfig),mapConfig.defaultZoom);map.setMaxBounds(calc.maxBounds(mapConfig));drawnItems=L.featureGroup();map.addLayer(drawnItems);drawnMarkers=L.featureGroup();map.addLayer(drawnMarkers);frontline=L.featureGroup();map.addLayer(frontline);hiddenLayers=L.featureGroup();drawControl=new L.Control.Draw({draw:{polygon:{showLength:false,shapeOptions:LINE_OPTIONS},rectangle:false,circle:false,polyline:{showLength:false,shapeOptions:LINE_OPTIONS},marker:{icon:icons.factory(content.default.pointType,content.default.pointColor)}},edit:{featureGroup:drawnItems,edit:L.Browser.touch?false:{selectedPathOptions:{maintainColor:true,opacity:.4,fill:false}}}});map.addControl(drawControl);var titleControl=new L.Control.TitleControl({});map.addControl(titleControl);var clearButton=new L.Control.CustomToolbar({position:"bottomleft",buttons:[{id:"clear-button",icon:"fa-trash",tooltip:content.clearTooltip,clickFn:function(){if(!mapIsEmpty()){map.openModal({template:content.confirmClearModalTemplate,onShow:function(e){var element=document.getElementById("confirm-cancel-button");element.focus();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){clearMap();e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})},onHide:function(){checkButtonsDisabled()}})}}}]});map.addControl(clearButton);var helpSettingsToolbar=new L.Control.CustomToolbar({position:"bottomright",buttons:[{id:"settings-button",icon:"fa-gear",tooltip:content.settingsTooltip,clickFn:function(){map.openModal({template:content.settingsModalTemplate,onShow:function(e){var mapSelect=document.getElementById("map-select");mapSelect.selectedIndex=selectedMapIndex;var originalIndex=selectedMapIndex;var styleSelect=document.getElementById("style-select");var originalStyleValue=state.style;styleSelect.value=originalStyleValue;var invertCheckbox=document.getElementById("invert-text-checkbox");invertCheckbox.checked=state.colorsInverted;var unitsSelect=document.getElementById("units-select");var originalUnitValue=state.units;unitsSelect.value=originalUnitValue;var backgroundCheckbox=document.getElementById("text-background-checkbox");backgroundCheckbox.checked=state.showBackground;mapSelect.focus();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){if(mapSelect.selectedIndex!==originalIndex){var selectedMap=mapSelect.options[mapSelect.selectedIndex].value;mapConfig=content.maps[selectedMap];selectMap(mapConfig);selectedMapIndex=mapSelect.selectedIndex;publishMapState()}if(styleSelect.value!==originalStyleValue){changeStyle(styleSelect.value)}if(unitsSelect.value!==originalUnitValue){changeUnits(unitsSelect.value)}if(state.style==="classic"){if(invertCheckbox.checked!==state.colorsInverted){state.colorsInverted=invertCheckbox.checked;var textElements=document.getElementsByClassName("map-text");for(var i=0;i<textElements.length;i++){if(state.colorsInverted){textElements[i].classList.add("inverted")}else{textElements[i].classList.remove("inverted")}}}if(backgroundCheckbox.checked!==state.showBackground){state.showBackground=backgroundCheckbox.checked;var textElements=document.getElementsByClassName("map-text");for(var i=0;i<textElements.length;i++){if(state.showBackground){textElements[i].classList.remove("nobg")}else{textElements[i].classList.add("nobg")}}}}e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}},{id:"help-button",icon:"fa-question",tooltip:content.helpTooltip,clickFn:function(){map.openModal({template:content.helpModalTemplate,onShow:function(e){L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){e.modal.hide()})}})}}]});map.addControl(helpSettingsToolbar);var importExportToolbar=new L.Control.CustomToolbar({position:"bottomleft",buttons:[{id:"import-button",icon:"fa-upload",tooltip:content.importTooltip,clickFn:function(){map.openModal({template:content.importModalTemplate,onShow:function(e){var importInput=document.getElementById("import-file");importInput.focus();var fileContent;L.DomEvent.on(importInput,"change",function(evt){var reader=new window.FileReader;reader.onload=function(evt){if(evt.target.readyState!==2){return}if(evt.target.error){window.alert("Error while reading file");return}fileContent=evt.target.result};reader.readAsText(evt.target.files[0])});L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){var saveData=JSON.parse(fileContent);importMapState(saveData);e.modal.hide();fitViewToMission()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})},onHide:function(){checkButtonsDisabled()}})}},{id:"export-button",icon:"fa-download",tooltip:content.exportTooltip,clickFn:function(){if(!mapIsEmpty()){util.download("plan.json",JSON.stringify(exportMapState()))}}},{id:"stream-button",icon:"fa-share-alt",tooltip:content.streamTooltip,clickFn:function(){var template;if(!state.streaming&&!state.connected){template=content.streamModalTemplate;fireStreamModal()}else if(state.streaming&&!state.connected){template=content.alreadyStreamingModalTemplate;fireAlreadyStreamingModal()}else if(!state.streaming&&state.connected){template=content.alreadyConnectedModalTemplate;fireAlreadyConnectedModal()}function fireStreamModal(){if(conf.streaming===true){map.openModal({template:template,onShow:function(e){document.getElementById("stream-start-button").focus();L.DomEvent.on(document.getElementById("stream-start-button"),"click",function(){e.modal.hide();fireStartModal()});L.DomEvent.on(document.getElementById("stream-connect-button"),"click",function(){e.modal.hide();fireConnectModal()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}}function fireStartModal(){map.openModal({template:content.startStreamModalTemplate,onShow:function(e){document.getElementById("stream-start-confirm-button").focus();L.DomEvent.on(document.getElementById("stream-start-confirm-button"),"click",function(){var streamName=document.getElementById("stream-name").value;var streamPassword=document.getElementById("stream-password").value;var streamCode=document.getElementById("stream-leader-code").value;if(!streamName||!streamPassword||!streamCode){var errorElement=document.getElementById("start-stream-error");errorElement.innerHTML="All fields are required. Try again.";util.removeClass(errorElement,"hidden-section");return}var mapState=window.escape(JSON.stringify(exportMapState()));var response=webdis.startStream(streamName,streamPassword,streamCode,mapState);if(response[0]!=="SUCCESS"){var errorElement=document.getElementById("start-stream-error");errorElement.innerHTML=response[1];util.removeClass(errorElement,"hidden-section");return}state.streaming=true;util.addClass(document.querySelector("a.fa-share-alt"),"streaming");state.streamInfo={name:streamName,password:streamPassword,code:streamCode};e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}function fireConnectModal(){map.openModal({template:content.connectStreamModalTemplate,onShow:function(e){var streamSelect=document.getElementById("stream-select");var streams=webdis.getStreamList();streamSelect.options.length=0;for(var i=0;i<streams.length;i++){streamSelect.options[i]=new Option(streams[i].substring(7),streams[i].substring(7))}setupCheckboxTogglableElement("leader-checkbox","leader-hidden");document.getElementById("stream-connect-button").focus();L.DomEvent.on(document.getElementById("stream-connect-button"),"click",function(){var selectedStream=streamSelect.options[streamSelect.selectedIndex].value;var password=document.getElementById("stream-password").value;var code,response;var checkbox=document.getElementById("leader-checkbox");if(checkbox.checked){if(V.fails("connect-form")){var errorElement=document.getElementById("connect-stream-error");errorElement.innerHTML="Password and code are required to connect.";util.removeClass(errorElement,"hidden-section");return}code=document.getElementById("stream-code").value;response=webdis.getStreamReconnect(selectedStream,password,code);if(response[0]!=="SUCCESS"){var errorElement=document.getElementById("connect-stream-error");errorElement.innerHTML=response[1];util.removeClass(errorElement,"hidden-section");return}state.streamInfo.code=code;clearMap();importMapState(JSON.parse(response[2]));state.streaming=true;util.addClass(document.querySelector("a.fa-share-alt"),"streaming")}else{if(V.fails("connect-form")){var errorElement=document.getElementById("connect-stream-error");errorElement.innerHTML="Password is required to connect.";util.removeClass(errorElement,"hidden-section");return}response=webdis.getStreamInfo(selectedStream,password);if(response[0]!=="SUCCESS"){var errorElement=document.getElementById("connect-stream-error");errorElement.innerHTML=response[1];util.removeClass(errorElement,"hidden-section");return}webdis.subscribe(response[1]);clearMap();importMapState(JSON.parse(response[2]));state.connected=response[1];util.addClass(document.querySelector("a.fa-share-alt"),"connected");startConnectedMode()}state.streamInfo={name:selectedStream,password:password,code:code};checkButtonsDisabled();e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}function fireAlreadyConnectedModal(){map.openModal({streamName:state.streamInfo.name,template:content.alreadyConnectedModalTemplate,onShow:function(e){document.getElementById("disconnect-button").focus();L.DomEvent.on(document.getElementById("disconnect-button"),"click",function(){webdis.unsubscribe(state.connected);state.connected=false;util.removeClass(document.querySelector("a.fa-share-alt"),"connected");endConnectedMode();e.modal.hide()});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}function fireAlreadyStreamingModal(){map.openModal({streamName:state.streamInfo.name,streamPassword:state.streamInfo.password,streamCode:state.streamInfo.code,template:content.alreadyStreamingModalTemplate,onShow:function(e){document.getElementById("stop-streaming-button").focus();setupCheckboxTogglableElement("already-streaming-checkbox","already-streaming-hidden");L.DomEvent.on(document.getElementById("stop-streaming-button"),"click",function(){e.modal.hide();state.streaming=false;util.removeClass(document.querySelector("a.fa-share-alt"),"streaming")});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}}}]});map.addControl(importExportToolbar);var gridToolbar=new L.Control.CustomToolbar({position:"topleft",buttons:[{id:"gridhop-button",icon:"fa-th-large",tooltip:content.gridHopTooltip,clickFn:function(){map.openModal({template:content.gridJumpModalTemplate,onShow:function(e){var gridElement=document.getElementById("grid-input");gridElement.focus();L.DomEvent.on(e.modal._container.querySelector(".modal-ok"),"click",function(){if(V.passes("grid-jump-form")){var grid=gridElement.value;var viewLatLng=calc.gridLatLng(grid,mapConfig);map.setView(viewLatLng,mapConfig.gridHopZoom);e.modal.hide()}else{var errorElement=document.getElementById("grid-jump-error");errorElement.innerHTML="Please input a valid four digit grid number.";util.removeClass(errorElement,"hidden-section");errorElement.focus()}});L.DomEvent.on(e.modal._container.querySelector(".modal-cancel"),"click",function(){e.modal.hide()})}})}},{id:"missionhop-button",icon:"fa-crop",tooltip:content.missionHopTooltip,clickFn:function(){if(!mapIsEmpty()){fitViewToMission()}}}]});map.addControl(gridToolbar);map.on("draw:created",function(e){drawnItems.addLayer(e.layer);if(e.layerType==="polyline"){applyFlightPlan(e.layer)}else if(e.layerType==="marker"){applyTargetInfo(e.layer)}else if(e.layerType==="circle"){applyCircle(e.layer)}else if(e.layerType==="polygon"){applyPolygon(e.layer)}checkButtonsDisabled()});map.on("draw:deleted",function(e){deleteAssociatedLayers(e.layers);publishMapState();checkButtonsDisabled()});map.on("draw:edited",function(e){deleteAssociatedLayers(e.layers);e.layers.eachLayer(function(layer){if(util.isPolygon(layer)){}else if(util.isLine(layer)){layer.wasEdited=layer.getLatLngs().length-1!==layer.speeds.length;applyFlightPlanCallback(layer)}else if(util.isCircle(layer)){}else if(util.isMarker(layer)){applyTargetInfoCallback(layer)}});publishMapState()});map.on("draw:editstart",function(){state.changing=true;hideChildLayers()});map.on("draw:editstop",function(){state.changing=false;showChildLayers();checkButtonsDisabled()});map.on("draw:deletestart",function(){state.changing=true;hideChildLayers()});map.on("draw:deletestop",function(){state.changing=false;showChildLayers();checkButtonsDisabled()});window.addEventListener("il2:streamerror",function(e){if(!state.connected){return}util.addClass(document.querySelector("a.fa-share-alt"),"stream-error")});window.addEventListener("il2:streamupdate",function(e){if(!state.connected){return}var saveData=e.detail;if(saveData!==1){clearMap();importMapState(JSON.parse(saveData))}util.removeClass(document.querySelector("a.fa-share-alt"),"stream-error");checkButtonsDisabled()});checkButtonsDisabled()})()},{"./calc.js":1,"./content.js":2,"./controls.js":3,"./icons.js":4,"./util.js":6,"./webdis.js":7}],6:[function(require,module,exports){module.exports=function(){var calc=require("./calc.js");const UNIT_MAP={metric:{distance:"km",speed:"kph",altitude:"m"},imperial:{distance:"mi",speed:"mph",altitude:"ft"}};return{formatTime:function(timeInSeconds){var minutes=timeInSeconds/60;var seconds=timeInSeconds%60;return Math.floor(minutes).toFixed(0)+":"+calc.pad(seconds,2)},isAvailableMapHash:function(hash,maps){for(var map in maps){if(maps[map].hash===hash){return true}}return false},getSelectedMapConfig:function(hash,maps){for(var map in maps){if(maps[map].hash===hash){return maps[map]}}return maps.stalingrad},defaultPopulateArray:function(val,count){var array=[];for(var i=0;i<count;i++){array.push(val)}return array},formatFlightLegMarker:function(distance,heading,speed,time,units){units=units||"metric";distance=typeof distance==="number"?distance.toFixed(1):distance;heading=typeof heading==="number"?heading.toFixed(0):heading;return distance+UNIT_MAP[units].distance+" | "+calc.pad(heading,3)+"&deg;/"+calc.pad(calc.invertHeading(heading),3)+"&deg; <br/> "+speed+UNIT_MAP[units].speed+" | "+"ETE "+time},formatFlightStartMarker:function(name,altitude,units){units=units||"metric";return name+"<br />"+altitude+UNIT_MAP[units].altitude},formatFlightTurnMarker:function(altitude,units){units=units||"metric";return Math.round(altitude)+UNIT_MAP[units].altitude},isLine:function(layer){return typeof layer.getLatLngs!=="undefined"},isCircle:function(layer){return typeof layer.getBounds!=="undefined"},isPolygon:function(layer){return typeof layer.getLatLngs!=="undefined"&&layer.options.fillOpacity!==-1},isMarker:function(layer){return typeof layer.getLatLng!=="undefined"},buildGetXhr:function(url,updateFn){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.onreadystatechange=updateFn;xhr.send(null);return xhr},buildSyncGetXhr:function(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr},hasClass:function(el,className){if(el.classList){return el.classList.contains(className)}else{return!!el.className.match(new RegExp("(\\s|^)"+className+"(\\s|$)"))}},addClass:function(el,className){if(el.classList){el.classList.add(className)}else if(!this.hasClass(el,className)){el.className+=" "+className}},removeClass:function(el,className){if(el.classList){el.classList.remove(className)}else if(this.hasClass(el,className)){var reg=new RegExp("(\\s|^)"+className+"(\\s|$)");el.className=el.className.replace(reg," ")}},download:function(filename,text){var pom=document.createElement("a");pom.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(text));pom.setAttribute("download",filename);if(document.createEvent){var event=document.createEvent("MouseEvents");event.initEvent("click",true,true);pom.dispatchEvent(event)}else{pom.click()}}}}()},{"./calc.js":1}],7:[function(require,module,exports){module.exports=function(){var fs=require("fs");var util=require("./util.js");var conf=JSON.parse('{\n  "apiUrl"    : "NONE",\n  "serverUrl" : "https://serverror.github.io/IL2-Mission-Planner",\n  "tilesUrl"  : "https://serverror.github.io/IL2-Mission-Planner/tiles",\n  "streaming" : false,\n  "webdisUrl" : "https://serverror.github.io/IL2-Mission-Planner/WEBDIS"\n}\n');const WEBDIS_HOST=conf.webdisUrl;return{scripts:{getChannel:"",publishState:"",newStream:"",getReconnect:""},init:function(){var requiredKeys=Object.keys(this.scripts);var response=this.hmget("scripts",requiredKeys);if(response.length!==requiredKeys.length){return false}for(var i=0;i<response.length;i++){this.scripts[requiredKeys[i]]=response[i]}return true},publish:function(stream,password,code,state){var url=this._buildEvalshaUrl(this.scripts.publishState,[stream,password,code,state]);var xhr=util.buildGetXhr(url,function(){if(xhr.readyState===4){var responseBody=JSON.parse(xhr.responseText).EVALSHA;if(responseBody[0]!=="SUCCESS"){this._errorHandler()}}})},hmget:function(key,fields){var url=this._buildHmgetUrl(key,fields);var response=util.buildSyncGetXhr(url);return JSON.parse(response.responseText).HMGET},subscribe:function(channel){var prev_length=0;var url=this._buildSubscribeUrl(channel);var xhr=util.buildGetXhr(url,function(){if(xhr.readyState===3){var response=xhr.responseText;try{var chunk=JSON.parse(response.slice(prev_length));if(!chunk||typeof chunk!=="object"){this._errorHandler()}}catch(e){this._errorHandler()}var newState=chunk.SUBSCRIBE[2];prev_length=response.length;var evt=new CustomEvent("il2:streamupdate",{detail:newState});window.dispatchEvent(evt)}})},unsubscribe:function(channel){var url=this._buildUnsubscribeUrl(channel);util.buildGetXhr(url,function(){})},getStreamList:function(){var url=this._buildKeysUrl("stream:*");var response=util.buildSyncGetXhr(url);return JSON.parse(response.responseText).KEYS},getStreamInfo:function(stream,password){var url=this._buildEvalshaUrl(this.scripts.getChannel,[stream,password]);var response=util.buildSyncGetXhr(url);return JSON.parse(response.responseText).EVALSHA},getStreamReconnect:function(stream,password,code){var url=this._buildEvalshaUrl(this.scripts.getReconnect,[stream,password,code]);var response=util.buildSyncGetXhr(url);return JSON.parse(response.responseText).EVALSHA},startStream:function(name,password,code,state){var url=this._buildEvalshaUrl(this.scripts.newStream,[name,password,code,state]);var response=util.buildSyncGetXhr(url);return JSON.parse(response.responseText).EVALSHA},_buildEvalshaUrl:function(hash,args){var url=WEBDIS_HOST+"/EVALSHA/"+hash+"/0";for(var i=0;i<args.length;i++){url+="/"+args[i]}return url},_buildHmgetUrl:function(key,fields){var url=WEBDIS_HOST+"/HMGET/"+key;for(var i=0;i<fields.length;i++){url+="/"+fields[i]}return url},_buildKeysUrl:function(pattern){return WEBDIS_HOST+"/KEYS/"+pattern},_buildSubscribeUrl:function(channel){return WEBDIS_HOST+"/SUBSCRIBE/"+channel},_buildPublishUrl:function(channel,value){return WEBDIS_HOST+"/PUBLISH/"+channel+"/"+value},_buildUnsubscribeUrl:function(channel,value){return WEBDIS_HOST+"/UNSUBSCRIBE/"+channel},_errorHandler:function(){var evt=new CustomEvent("il2:streamerror");window.dispatchEvent(evt)}}}()},{"./util.js":6,fs:8}],8:[function(require,module,exports){},{}]},{},[5]);